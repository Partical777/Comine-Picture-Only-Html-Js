<!DOCTYPE html>
<html>
    <head>
        <title>Coat of Arms Generater</title>
        <meta charset="UTF-8" />

        <script src="https://unpkg.com/konva@3.4.1/konva.min.js"></script>
        <link rel="stylesheet" type="text/css" href="./src/styles.css" />
    </head>

    <body>
        <p>
            Drag&drop yoda into the grey area.
        </p>
        <div id="drag-items">
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/1-1.png"
                draggable="true"
            />
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/1-2.png"
                draggable="true"
            />
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/1-3.png"
                draggable="true"
            />
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/1-4.png"
                draggable="true"
            />
        </div>
        <div id="container"></div>
        <script>
            var width = 750;
            var height = 750;

            var stage = new Konva.Stage({
                container: "container",
                width: width,
                height: height
            });
            var layer = new Konva.Layer();

            // //Tooltip
            // var shapesLayer = new Konva.Layer();
            // var tooltipLayer = new Konva.Layer();

            //     Drag & Drop Image
            // what is url of dragging element?
            var itemURL = "";
            document
                .getElementById("drag-items")
                .addEventListener("dragstart", function(e) {
                    itemURL = e.target.src;
                });

            var con = stage.container();
            con.addEventListener("dragover", function(e) {
                e.preventDefault(); // !important
            });

            con.addEventListener("drop", function(e) {
                e.preventDefault();
                // now we need to find pointer position
                // we can't use stage.getPointerPosition() here, because that event
                // is not registered by Konva.Stage
                // we can register it manually:
                stage.setPointersPositions(e);

                Konva.Image.fromURL(itemURL, function(image) {
                    layer.add(image);
                    stage.getPointerPosition().x -= 200;
                    stage.getPointerPosition().y -= 200;

                    image.position(stage.getPointerPosition());
                    image.draggable(true);

                    layer.draw();
                });
            });
            //=====Drag & Drop Image

            // //     Tooltip
            // layer.addEventListener("mousemove", function(e) {
            //     e.preventDefault();
            //     stage.setPointersPositions(e);
            //     var mousePos = stage.getPointerPosition();
            //     tooltip.position({
            //         x: mousePos.x - 60,
            //         y: mousePos.y - 50
            //     });
            //     tooltip.text("Hello World!");
            //     tooltip.show();
            //     tooltipLayer.batchDraw();
            // });

            // layer.addEventListener("mouseout", function(e) {
            //     tooltip.hide();
            //     tooltipLayer.draw();
            // });

            // var tooltip = new Konva.Text({
            //     text: "",
            //     fontFamily: "Calibri",
            //     fontSize: 24,
            //     padding: 5,
            //     textFill: "white",
            //     fill: "black",
            //     alpha: 0.75,
            //     visible: false
            // });

            // tooltipLayer.add(tooltip);
            // //=====Tooltip

            //Hover
            let tmp;
            let CirclesGroup = new Konva.Group();

            layer.on("mouseover", function(evt) {
                var shape = evt.target;
                document.body.style.cursor = "move";
                shape.stroke("#fc766a");
                layer.draw();
            });
            layer.on("mouseout", function(evt) {
                var shape = evt.target;
                if (shape !== tmp) {
                    document.body.style.cursor = "default";
                    shape.stroke("");
                    layer.draw();
                }
            });
            layer.on("click", function(evt) {
                var shape = evt.target;
                //if click others shape
                if (tmp !== undefined && shape !== tmp) {
                    tmp.stroke("");
                    tmp.strokeWidth(2);
                    CirclesGroup.destroy();
                }
                tmp = shape;
                document.body.style.cursor = "default";
                shape.stroke("#fc766a");
                shape.strokeWidth(7.5);
                console.log(shape.attrs.x + "+" + shape.attrs.y);
                AddCircles(shape.attrs.x, shape.attrs.y);
                layer.draw();
            });
            //=====Hover

            function AddCircles(x, y) {
                let arr = [
                    [0, 0],
                    [1, 0],
                    [2, 0],
                    [0, 1],
                    [2, 1],
                    [0, 2],
                    [1, 2],
                    [2, 2]
                ];
                arr.forEach(function(el) {
                    let circle = new Konva.Circle({
                        x: x + 210 * el[0],
                        y: y + 210 * el[1],
                        radius: 12,
                        fill: "red",
                        stroke: "black",
                        strokeWidth: 4
                    });
                    // add the circle to the group
                    CirclesGroup.add(circle);
                });

                // add the group to the layer
                layer.add(CirclesGroup);
            }

            stage.add(layer);
            // stage.add(tooltipLayer);
        </script>

        <!-- <div align="center">
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/1-1.png"
                width="300"
            />
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/1-2.png"
                width="300"
            />
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/1-3.png"
                width="300"
            />
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/1-4.png"
                width="300"
            />
        </div>
        <div id="imgBox1" align="center">
            <input type="button" value="一鍵合成" id="combineMe1" />
        </div>

</br>
</br>
</br>

        <div align="center">
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/2-1.png"
                width="300"
            />
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/2-2.png"
                width="300"
            />
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/2-3.png"
                width="300"
            />
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/2-4.png"
                width="300"
            />
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/2-5.png"
                width="300"
            />
            <img
                src="https://partical777.github.io/Comine-Picture-Only-Html-Js/img/2-6.png"
                width="300"
            />
        </div>
        <div id="imgBox2" align="center">
            <input type="button" value="一鍵合成" id="combineMe2" />
        </div>

        <script src="src/index.js"></script> -->
    </body>
</html>
